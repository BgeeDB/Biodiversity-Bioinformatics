if (!require("topGO", quietly = TRUE))
    BiocManager::install("topGO")
if (!require("GO.db", quietly = TRUE))
  BiocManager::install("GO.db")
if (!require("biomaRt", quietly = TRUE))
  BiocManager::install("biomaRt")
if (!require("Rgraphviz", quietly = TRUE))
  BiocManager::install("Rgraphviz")
library(topGO)
library(GO.db)
library(biomaRt)
library(Rgraphviz)


#### Preparing data ####

#background correspond to all genes. The list of genes has been retrieved from Bgee 15.2
bg_genes_gar <- read.table(file = "/workspace/Biodiversity-Bioinformatics/data/allGenesGar.tsv", header = TRUE, sep = "\t", quote = "")$geneId

#foreground genes
foreground <- c("ENSLOCG00000002829", "ENSLOCG00000011357", "ENSLOCG00000008712", "ENSLOCG00000001439", "ENSLOCG00000009935", "ENSLOCG00000006699", "ENSLOCG00000013155", "ENSLOCG00000014902", "ENSLOCG00000004823", "ENSLOCG00000011526", "ENSLOCG00000009053", "ENSLOCG00000004517", "ENSLOCG00000014405", "ENSLOCG00000018219", "ENSLOCG00000001681", "ENSLOCG00000013052", "ENSLOCG00000011833", "ENSLOCG00000002107", "ENSLOCG00000007400", "ENSLOCG00000000341", "ENSLOCG00000013046", "ENSLOCG00000006297", "ENSLOCG00000016505", "ENSLOCG00000009655", "ENSLOCG00000014974", "ENSLOCG00000000035", "ENSLOCG00000015194", "ENSLOCG00000010764", "ENSLOCG00000004387", "ENSLOCG00000004622", "ENSLOCG00000003508", "ENSLOCG00000004387", "ENSLOCG00000011363", "ENSLOCG00000012596", "ENSLOCG00000007833", "ENSLOCG00000004193", "ENSLOCG00000009083", "ENSLOCG00000008660", "ENSLOCG00000007277", "ENSLOCG00000002268", "ENSLOCG00000009261", "ENSLOCG00000001197", "ENSLOCG00000002417", "ENSLOCG00000012934", "ENSLOCG00000017452", "ENSLOCG00000005981", "ENSLOCG00000013264", "ENSLOCG00000003397", "ENSLOCG00000004380", "ENSLOCG00000001987", "ENSLOCG00000002564", "ENSLOCG00000005544", "ENSLOCG00000006981", "ENSLOCG00000002345", "ENSLOCG00000007430", "ENSLOCG00000010405", "ENSLOCG00000015895", "ENSLOCG00000003578", "ENSLOCG00000000040", "ENSLOCG00000015451", "ENSLOCG00000012462", "ENSLOCG00000005025", "ENSLOCG00000015900", "ENSLOCG00000007414", "ENSLOCG00000013878", "ENSLOCG00000014238", "ENSLOCG00000010167", "ENSLOCG00000016941", "ENSLOCG00000001031", "ENSLOCG00000012492", "ENSLOCG00000008187", "ENSLOCG00000014664", "ENSLOCG00000016047", "ENSLOCG00000013126", "ENSLOCG00000004840", "ENSLOCG00000008696", "ENSLOCG00000002032", "ENSLOCG00000004290", "ENSLOCG00000018047", "ENSLOCG00000017452", "ENSLOCG00000003889", "ENSLOCG00000017813", "ENSLOCG00000016436", "ENSLOCG00000016295", "ENSLOCG00000011522", "ENSLOCG00000001619", "ENSLOCG00000012377", "ENSLOCG00000014966", "ENSLOCG00000003576", "ENSLOCG00000017037", "ENSLOCG00000007610", "ENSLOCG00000007497", "ENSLOCG00000003610", "ENSLOCG00000011696", "ENSLOCG00000013021", "ENSLOCG00000011770", "ENSLOCG00000011221", "ENSLOCG00000002689", "ENSLOCG00000009051", "ENSLOCG00000014500", "ENSLOCG00000014196", "ENSLOCG00000011814", "ENSLOCG00000009658", "ENSLOCG00000010856", "ENSLOCG00000004882", "ENSLOCG00000000202", "ENSLOCG00000007067", "ENSLOCG00000012695", "ENSLOCG00000000612", "ENSLOCG00000003994", "ENSLOCG00000016442", "ENSLOCG00000016674", "ENSLOCG00000001760", "ENSLOCG00000013664", "ENSLOCG00000012891", "ENSLOCG00000007840", "ENSLOCG00000012935", "ENSLOCG00000013021", "ENSLOCG00000000906", "ENSLOCG00000009431", "ENSLOCG00000009863", "ENSLOCG00000014618", "ENSLOCG00000005121", "ENSLOCG00000010911", "ENSLOCG00000004074", "ENSLOCG00000006766", "ENSLOCG00000006700", "ENSLOCG00000014165", "ENSLOCG00000017946", "ENSLOCG00000001798", "ENSLOCG00000007152", "ENSLOCG00000003464", "ENSLOCG00000016841", "ENSLOCG00000014110", "ENSLOCG00000006271", "ENSLOCG00000003690", "ENSLOCG00000005179", "ENSLOCG00000005291", "ENSLOCG00000006962", "ENSLOCG00000006807", "ENSLOCG00000010954", "ENSLOCG00000014503", "ENSLOCG00000009153", "ENSLOCG00000006535", "ENSLOCG00000017901", "ENSLOCG00000007562", "ENSLOCG00000002022", "ENSLOCG00000000422", "ENSLOCG00000004537", "ENSLOCG00000003384", "ENSLOCG00000016666", "ENSLOCG00000002914", "ENSLOCG00000015121", "ENSLOCG00000006101", "ENSLOCG00000011412", "ENSLOCG00000013818", "ENSLOCG00000011274", "ENSLOCG00000009564", "ENSLOCG00000012724", "ENSLOCG00000017204", "ENSLOCG00000001459", "ENSLOCG00000002980", "ENSLOCG00000014640", "ENSLOCG00000004638", "ENSLOCG00000003733", "ENSLOCG00000017097", "ENSLOCG00000006450", "ENSLOCG00000004031", "ENSLOCG00000015865", "ENSLOCG00000001460", "ENSLOCG00000005714", "ENSLOCG00000010973", "ENSLOCG00000009915", "ENSLOCG00000001997", 
"ENSLOCG00000007107", "ENSLOCG00000016479", "ENSLOCG00000009861", "ENSLOCG00000004129", "ENSLOCG00000007917", "ENSLOCG00000011513", "ENSLOCG00000000339", "ENSLOCG00000002505", "ENSLOCG00000009969", "ENSLOCG00000009528", "ENSLOCG00000017174", "ENSLOCG00000005826", "ENSLOCG00000000023", "ENSLOCG00000000684", "ENSLOCG00000011940", "ENSLOCG00000008502", "ENSLOCG00000000220", "ENSLOCG00000010122", "ENSLOCG00000002237", "ENSLOCG00000003641", "ENSLOCG00000004893", "ENSLOCG00000012309", "ENSLOCG00000018134", "ENSLOCG00000017860", "ENSLOCG00000009385", "ENSLOCG00000013304", "ENSLOCG00000016317", "ENSLOCG00000002905", "ENSLOCG00000001400", "ENSLOCG00000014085", "ENSLOCG00000008912", "ENSLOCG00000001847", "ENSLOCG00000009387", "ENSLOCG00000014166", "ENSLOCG00000005005", "ENSLOCG00000004311", "ENSLOCG00000010664", "ENSLOCG00000003794", "ENSLOCG00000012065", "ENSLOCG00000009157", "ENSLOCG00000003738", "ENSLOCG00000004554", "ENSLOCG00000012292", "ENSLOCG00000001378", "ENSLOCG00000009603", "ENSLOCG00000001012", "ENSLOCG00000014563", "ENSLOCG00000013659", "ENSLOCG00000009076", "ENSLOCG00000004933", "ENSLOCG00000010978", "ENSLOCG00000017626", "ENSLOCG00000014551", "ENSLOCG00000010394", "ENSLOCG00000009502", "ENSLOCG00000012652", "ENSLOCG00000002353", "ENSLOCG00000005005", "ENSLOCG00000012530", "ENSLOCG00000004835", "ENSLOCG00000004837", "ENSLOCG00000007214", "ENSLOCG00000016906", "ENSLOCG00000012847", "ENSLOCG00000010765", "ENSLOCG00000017299", "ENSLOCG00000017869", "ENSLOCG00000008352", "ENSLOCG00000001597", "ENSLOCG00000017406", "ENSLOCG00000004684", "ENSLOCG00000007555", "ENSLOCG00000009668", "ENSLOCG00000015385", "ENSLOCG00000001843", "ENSLOCG00000017904", "ENSLOCG00000003911", "ENSLOCG00000005005", "ENSLOCG00000016951", "ENSLOCG00000007855", "ENSLOCG00000007313", "ENSLOCG00000004135", "ENSLOCG00000005314", "ENSLOCG00000015114", "ENSLOCG00000012921", "ENSLOCG00000012131", "ENSLOCG00000005462", "ENSLOCG00000005220", "ENSLOCG00000012322", "ENSLOCG00000014854", "ENSLOCG00000013295", "ENSLOCG00000005068", "ENSLOCG00000015213", "ENSLOCG00000013339", "ENSLOCG00000011714", "ENSLOCG00000015237", "ENSLOCG00000002262", "ENSLOCG00000009693", "ENSLOCG00000007772", "ENSLOCG00000005971", "ENSLOCG00000013081", "ENSLOCG00000006393", "ENSLOCG00000008787", "ENSLOCG00000012133", "ENSLOCG00000000036", "ENSLOCG00000000249", "ENSLOCG00000017452", "ENSLOCG00000010146", "ENSLOCG00000017452", "ENSLOCG00000013755", "ENSLOCG00000003590", "ENSLOCG00000008504", "ENSLOCG00000004069", "ENSLOCG00000001014", "ENSLOCG00000004274", "ENSLOCG00000017452", "ENSLOCG00000015964", "ENSLOCG00000016756", "ENSLOCG00000010245", "ENSLOCG00000010587", "ENSLOCG00000009072",
"ENSLOCG00000011888", "ENSLOCG00000006922", "ENSLOCG00000004545", "ENSLOCG00000011577", "ENSLOCG00000017057", "ENSLOCG00000004651", "ENSLOCG00000014981", "ENSLOCG00000016982", "ENSLOCG00000001172", "ENSLOCG00000014028", "ENSLOCG00000006038", "ENSLOCG00000011025", "ENSLOCG00000016084", "ENSLOCG00000001336", "ENSLOCG00000011555", "ENSLOCG00000007702", "ENSLOCG00000017371", "ENSLOCG00000010194", "ENSLOCG00000015716", "ENSLOCG00000015647", "ENSLOCG00000018353", "ENSLOCG00000013095", "ENSLOCG00000010906", "ENSLOCG00000000339", "ENSLOCG00000015753", "ENSLOCG00000003963", "ENSLOCG00000006421", "ENSLOCG00000004714", "ENSLOCG00000015942", "ENSLOCG00000017860", "ENSLOCG00000015043", "ENSLOCG00000006768", "ENSLOCG00000015496", "ENSLOCG00000002921", "ENSLOCG00000011174", "ENSLOCG00000008692", "ENSLOCG00000015493", "ENSLOCG00000007672", "ENSLOCG00000009480", "ENSLOCG00000005278", "ENSLOCG00000009534", "ENSLOCG00000003790", "ENSLOCG00000001665", "ENSLOCG00000013807", "ENSLOCG00000016046", "ENSLOCG00000014230", "ENSLOCG00000006215", "ENSLOCG00000009514", "ENSLOCG00000012919", "ENSLOCG00000004325", "ENSLOCG00000003619", "ENSLOCG00000008133", "ENSLOCG00000011307", "ENSLOCG00000007633", "ENSLOCG00000001897", "ENSLOCG00000011662", "ENSLOCG00000012549", "ENSLOCG00000002919", "ENSLOCG00000005616", "ENSLOCG00000008224", "ENSLOCG00000014265", "ENSLOCG00000009807", "ENSLOCG00000014160", "ENSLOCG00000008527", "ENSLOCG00000007343", "ENSLOCG00000000036", "ENSLOCG00000012959", "ENSLOCG00000016789", "ENSLOCG00000013952", "ENSLOCG00000015866", "ENSLOCG00000008672", "ENSLOCG00000001474", "ENSLOCG00000002237", "ENSLOCG00000010647", "ENSLOCG00000003285", "ENSLOCG00000012596", "ENSLOCG00000015967", "ENSLOCG00000017204", "ENSLOCG00000013956", "ENSLOCG00000006916", "ENSLOCG00000005570", "ENSLOCG00000002760", "ENSLOCG00000008398", "ENSLOCG00000004530", "ENSLOCG00000009997", "ENSLOCG00000011508", "ENSLOCG00000013536", "ENSLOCG00000004130", "ENSLOCG00000003098", "ENSLOCG00000000888", "ENSLOCG00000012788", "ENSLOCG00000003279", "ENSLOCG00000002434", "ENSLOCG00000013623", "ENSLOCG00000010292", "ENSLOCG00000006049", "ENSLOCG00000003482", "ENSLOCG00000004090", "ENSLOCG00000016368", "ENSLOCG00000010055", "ENSLOCG00000006604", "ENSLOCG00000014058", "ENSLOCG00000006899", "ENSLOCG00000008400", "ENSLOCG00000010532", "ENSLOCG00000015051", "ENSLOCG00000013847", "ENSLOCG00000004995", "ENSLOCG00000009258", "ENSLOCG00000008335", "ENSLOCG00000001089", "ENSLOCG00000003395", "ENSLOCG00000013228", "ENSLOCG00000014876", "ENSLOCG00000001110", "ENSLOCG00000007147", "ENSLOCG00000015846", "ENSLOCG00000003218", "ENSLOCG00000009534", "ENSLOCG00000003547", "ENSLOCG00000005203", "ENSLOCG00000011294", "ENSLOCG00000017922", "ENSLOCG00000012942", "ENSLOCG00000001475", "ENSLOCG00000011654", "ENSLOCG00000004956", "ENSLOCG00000004492", "ENSLOCG00000009851", "ENSLOCG00000013092", "ENSLOCG00000004786", "ENSLOCG00000003999", "ENSLOCG00000014218", "ENSLOCG00000015947", "ENSLOCG00000002067", "ENSLOCG00000007239", "ENSLOCG00000004579", "ENSLOCG00000012991", "ENSLOCG00000016142", "ENSLOCG00000011204", "ENSLOCG00000015021", "ENSLOCG00000012332", "ENSLOCG00000001585", "ENSLOCG00000013315", "ENSLOCG00000005158", "ENSLOCG00000012137", "ENSLOCG00000007866", "ENSLOCG00000011547", "ENSLOCG00000001884", "ENSLOCG00000013915", "ENSLOCG00000009167", "ENSLOCG00000009981", "ENSLOCG00000006027", "ENSLOCG00000013112", "ENSLOCG00000013726", "ENSLOCG00000013186", "ENSLOCG00000004635", "ENSLOCG00000006988", "ENSLOCG00000011490", "ENSLOCG00000011182", "ENSLOCG00000015933", "ENSLOCG00000006651", "ENSLOCG00000005845", "ENSLOCG00000000927", "ENSLOCG00000010058", "ENSLOCG00000003081", "ENSLOCG00000004011", "ENSLOCG00000004907", "ENSLOCG00000010773", "ENSLOCG00000008840", "ENSLOCG00000012296", "ENSLOCG00000014470", "ENSLOCG00000017753", "ENSLOCG00000004120", "ENSLOCG00000012913", 
"ENSLOCG00000014780", "ENSLOCG00000014200", "ENSLOCG00000017545", "ENSLOCG00000017452", "ENSLOCG00000000036", "ENSLOCG00000004216", "ENSLOCG00000009906", "ENSLOCG00000003246", "ENSLOCG00000011140", "ENSLOCG00000017242", "ENSLOCG00000008665", "ENSLOCG00000006422", "ENSLOCG00000012922", "ENSLOCG00000006622", "ENSLOCG00000013957", "ENSLOCG00000003669", "ENSLOCG00000013895", "ENSLOCG00000009008", "ENSLOCG00000007851", "ENSLOCG00000016055", "ENSLOCG00000013949", "ENSLOCG00000008581", "ENSLOCG00000013355", "ENSLOCG00000011979", "ENSLOCG00000007299", "ENSLOCG00000006731", "ENSLOCG00000016922", "ENSLOCG00000013758", "ENSLOCG00000000036", "ENSLOCG00000001522", "ENSLOCG00000006383", "ENSLOCG00000016059", "ENSLOCG00000006857", "ENSLOCG00000002487", "ENSLOCG00000007776", "ENSLOCG00000001584", "ENSLOCG00000017134", "ENSLOCG00000004190", "ENSLOCG00000011874", "ENSLOCG00000010828", "ENSLOCG00000001731", "ENSLOCG00000002085", "ENSLOCG00000011463", "ENSLOCG00000014329", "ENSLOCG00000011075", "ENSLOCG00000018131", "ENSLOCG00000010292", "ENSLOCG00000000036", "ENSLOCG00000015969", "ENSLOCG00000008096", "ENSLOCG00000005082", "ENSLOCG00000003107", "ENSLOCG00000014224", "ENSLOCG00000017798", "ENSLOCG00000001439", "ENSLOCG00000001850", "ENSLOCG00000014235", "ENSLOCG00000012510", "ENSLOCG00000005005", "ENSLOCG00000012498", "ENSLOCG00000012924", "ENSLOCG00000003955", "ENSLOCG00000008015", "ENSLOCG00000013628", "ENSLOCG00000009879", "ENSLOCG00000014731", "ENSLOCG00000013706", "ENSLOCG00000015938", "ENSLOCG00000004648", "ENSLOCG00000004181", "ENSLOCG00000007779", "ENSLOCG00000012045", "ENSLOCG00000001539", "ENSLOCG00000013769", "ENSLOCG00000012328", "ENSLOCG00000012158", "ENSLOCG00000012136", "ENSLOCG00000000689", "ENSLOCG00000006089", "ENSLOCG00000017207", "ENSLOCG00000014565", "ENSLOCG00000016129", "ENSLOCG00000007726", "ENSLOCG00000014722", "ENSLOCG00000007934", "ENSLOCG00000013874", "ENSLOCG00000008040", "ENSLOCG00000017452", "ENSLOCG00000011897", "ENSLOCG00000018218", "ENSLOCG00000014199", "ENSLOCG00000005135", "ENSLOCG00000017860", "ENSLOCG00000017405", "ENSLOCG00000009093", "ENSLOCG00000006223", "ENSLOCG00000014833", "ENSLOCG00000004378", "ENSLOCG00000009927", "ENSLOCG00000015060", "ENSLOCG00000011943", "ENSLOCG00000015050", "ENSLOCG00000000339", "ENSLOCG00000016828", "ENSLOCG00000018297", "ENSLOCG00000017985", "ENSLOCG00000012006", "ENSLOCG00000000846", "ENSLOCG00000018131", "ENSLOCG00000017085", "ENSLOCG00000010503", "ENSLOCG00000010589", "ENSLOCG00000004102", "ENSLOCG00000010089", "ENSLOCG00000008715", "ENSLOCG00000004781", "ENSLOCG00000000339", "ENSLOCG00000012574", "ENSLOCG00000003027", "ENSLOCG00000017364",
"ENSLOCG00000001280", "ENSLOCG00000016109", "ENSLOCG00000006036", "ENSLOCG00000003338", "ENSLOCG00000005115", "ENSLOCG00000008807", "ENSLOCG00000002015", "ENSLOCG00000006148", "ENSLOCG00000018271", "ENSLOCG00000013741", "ENSLOCG00000001752", "ENSLOCG00000012193", "ENSLOCG00000007221", "ENSLOCG00000001764", "ENSLOCG00000005005", "ENSLOCG00000003284", "ENSLOCG00000014107", "ENSLOCG00000007842", "ENSLOCG00000012599", "ENSLOCG00000000485", "ENSLOCG00000007487", "ENSLOCG00000007555", "ENSLOCG00000013260", "ENSLOCG00000016892", "ENSLOCG00000015519", "ENSLOCG00000007016", "ENSLOCG00000016183", "ENSLOCG00000009864", "ENSLOCG00000005152", "ENSLOCG00000015530", "ENSLOCG00000005553", "ENSLOCG00000004990", "ENSLOCG00000007053", "ENSLOCG00000002897", "ENSLOCG00000017224", "ENSLOCG00000005481", "ENSLOCG00000011595", "ENSLOCG00000004806", "ENSLOCG00000005870", "ENSLOCG00000006019", "ENSLOCG00000012353", "ENSLOCG00000010090", "ENSLOCG00000009467", "ENSLOCG00000001702", "ENSLOCG00000008509", "ENSLOCG00000000333", "ENSLOCG00000009801", "ENSLOCG00000005191", "ENSLOCG00000008480", "ENSLOCG00000004510", "ENSLOCG00000006144", "ENSLOCG00000015629", "ENSLOCG00000011681", "ENSLOCG00000003992", "ENSLOCG00000009944", "ENSLOCG00000003586", "ENSLOCG00000009766", "ENSLOCG00000015067", "ENSLOCG00000013507", "ENSLOCG00000013845", "ENSLOCG00000016220", "ENSLOCG00000013742", "ENSLOCG00000000339", "ENSLOCG00000011356", "ENSLOCG00000007246", "ENSLOCG00000007284", "ENSLOCG00000009788", "ENSLOCG00000011221", "ENSLOCG00000004532", "ENSLOCG00000016672", "ENSLOCG00000011154", "ENSLOCG00000008685", "ENSLOCG00000000530", "ENSLOCG00000010733", "ENSLOCG00000006811", "ENSLOCG00000006353", "ENSLOCG00000003590", "ENSLOCG00000012976", "ENSLOCG00000010600", "ENSLOCG00000003898", "ENSLOCG00000001451", "ENSLOCG00000008150", "ENSLOCG00000016018", "ENSLOCG00000010280", "ENSLOCG00000015513", "ENSLOCG00000008222", "ENSLOCG00000002983", "ENSLOCG00000014685", "ENSLOCG00000015130", "ENSLOCG00000015634", "ENSLOCG00000006360", "ENSLOCG00000011237", "ENSLOCG00000006660", "ENSLOCG00000006596", "ENSLOCG00000001573", "ENSLOCG00000017971", "ENSLOCG00000004716", "ENSLOCG00000010546", "ENSLOCG00000012632", "ENSLOCG00000008268", "ENSLOCG00000000536", "ENSLOCG00000007256", "ENSLOCG00000009164", "ENSLOCG00000003766", "ENSLOCG00000012685", "ENSLOCG00000006607", "ENSLOCG00000010247", "ENSLOCG00000005126", "ENSLOCG00000016895", "ENSLOCG00000006013", "ENSLOCG00000012610", "ENSLOCG00000003424", "ENSLOCG00000017452", "ENSLOCG00000011077", "ENSLOCG00000008611", "ENSLOCG00000007914", "ENSLOCG00000011797", "ENSLOCG00000013922", "ENSLOCG00000001533", "ENSLOCG00000011494", "ENSLOCG00000010549", "ENSLOCG00000011584", "ENSLOCG00000007243", "ENSLOCG00000013792", "ENSLOCG00000004601", "ENSLOCG00000016714", "ENSLOCG00000003024", "ENSLOCG00000003311", "ENSLOCG00000017758", "ENSLOCG00000000554", "ENSLOCG00000009507", "ENSLOCG00000013086", "ENSLOCG00000009455", "ENSLOCG00000006251", "ENSLOCG00000008643", "ENSLOCG00000013811", "ENSLOCG00000000545", "ENSLOCG00000002898", "ENSLOCG00000008903", "ENSLOCG00000005618", "ENSLOCG00000016670", "ENSLOCG00000011778", "ENSLOCG00000009135", "ENSLOCG00000000005", "ENSLOCG00000017980", "ENSLOCG00000007853", "ENSLOCG00000004862", "ENSLOCG00000016400", "ENSLOCG00000014289", "ENSLOCG00000009155", "ENSLOCG00000015114", "ENSLOCG00000003419", "ENSLOCG00000005256", "ENSLOCG00000018004", "ENSLOCG00000001959", "ENSLOCG00000000339", "ENSLOCG00000017452", "ENSLOCG00000016271", "ENSLOCG00000009656", "ENSLOCG00000008801", "ENSLOCG00000004244", "ENSLOCG00000010441", "ENSLOCG00000013280", "ENSLOCG00000005005", "ENSLOCG00000017860", "ENSLOCG00000014043", "ENSLOCG00000003138", "ENSLOCG00000016005", "ENSLOCG00000013260", "ENSLOCG00000017860", "ENSLOCG00000005878", "ENSLOCG00000004973", "ENSLOCG00000006638", "ENSLOCG00000013910", "ENSLOCG00000017193", 
"ENSLOCG00000011541", "ENSLOCG00000009166", "ENSLOCG00000011176", "ENSLOCG00000018158", "ENSLOCG00000012803", "ENSLOCG00000001262", "ENSLOCG00000015646", "ENSLOCG00000017948", "ENSLOCG00000006936", "ENSLOCG00000008309", "ENSLOCG00000001516", "ENSLOCG00000015488", "ENSLOCG00000008777", "ENSLOCG00000012127", "ENSLOCG00000002237", "ENSLOCG00000008293", "ENSLOCG00000004399", "ENSLOCG00000002237", "ENSLOCG00000008003", "ENSLOCG00000011645", "ENSLOCG00000002559", "ENSLOCG00000005422", "ENSLOCG00000006520", "ENSLOCG00000002767", "ENSLOCG00000000895", "ENSLOCG00000010556", "ENSLOCG00000001248", "ENSLOCG00000009412", "ENSLOCG00000006495", "ENSLOCG00000011998", "ENSLOCG00000014151", "ENSLOCG00000007653", "ENSLOCG00000008356", "ENSLOCG00000015164", "ENSLOCG00000017828", "ENSLOCG00000017241", "ENSLOCG00000018139", "ENSLOCG00000010494", "ENSLOCG00000003830", "ENSLOCG00000010248", "ENSLOCG00000008118", "ENSLOCG00000014808", "ENSLOCG00000008552", "ENSLOCG00000010920", "ENSLOCG00000008126", "ENSLOCG00000016919", "ENSLOCG00000003947", "ENSLOCG00000001251", "ENSLOCG00000013139", "ENSLOCG00000015082", "ENSLOCG00000006241", "ENSLOCG00000016104", "ENSLOCG00000009858", "ENSLOCG00000017057", "ENSLOCG00000001388", "ENSLOCG00000005354", "ENSLOCG00000013985", "ENSLOCG00000000738", "ENSLOCG00000006500", "ENSLOCG00000016903", "ENSLOCG00000010544", "ENSLOCG00000007323", "ENSLOCG00000010278", "ENSLOCG00000006838", "ENSLOCG00000018359", "ENSLOCG00000009756", "ENSLOCG00000008881", "ENSLOCG00000011442", "ENSLOCG00000015019", "ENSLOCG00000002089", "ENSLOCG00000015957", "ENSLOCG00000000339", "ENSLOCG00000017339", "ENSLOCG00000016584", "ENSLOCG00000015863", "ENSLOCG00000017860", "ENSLOCG00000015781", "ENSLOCG00000004374", "ENSLOCG00000008734", "ENSLOCG00000004285", "ENSLOCG00000000850", "ENSLOCG00000011142", "ENSLOCG00000007160", "ENSLOCG00000000026", "ENSLOCG00000008640", "ENSLOCG00000010304", "ENSLOCG00000011756", "ENSLOCG00000012636", "ENSLOCG00000009376", "ENSLOCG00000003931", "ENSLOCG00000003873", "ENSLOCG00000015621", "ENSLOCG00000000339", "ENSLOCG00000006767", "ENSLOCG00000002622", "ENSLOCG00000009737", "ENSLOCG00000008135", "ENSLOCG00000013361", "ENSLOCG00000014743", "ENSLOCG00000010069", "ENSLOCG00000000339", "ENSLOCG00000003267", "ENSLOCG00000011221", "ENSLOCG00000006632", "ENSLOCG00000006646", "ENSLOCG00000010673", "ENSLOCG00000013417", "ENSLOCG00000007859", "ENSLOCG00000000339", "ENSLOCG00000005680", "ENSLOCG00000011283", "ENSLOCG00000007897", "ENSLOCG00000012466", "ENSLOCG00000005293", "ENSLOCG00000008584", "ENSLOCG00000003331", "ENSLOCG00000004201", "ENSLOCG00000015472", "ENSLOCG00000017523", "ENSLOCG00000009994",
"ENSLOCG00000001979", "ENSLOCG00000011117", "ENSLOCG00000003973", "ENSLOCG00000000823", "ENSLOCG00000017923", "ENSLOCG00000013349", "ENSLOCG00000000187", "ENSLOCG00000006724", "ENSLOCG00000015935", "ENSLOCG00000016194", "ENSLOCG00000016027", "ENSLOCG00000015390", "ENSLOCG00000016649", "ENSLOCG00000004381", "ENSLOCG00000006615", "ENSLOCG00000008221", "ENSLOCG00000002926", "ENSLOCG00000007365", "ENSLOCG00000006842", "ENSLOCG00000007377", "ENSLOCG00000002791", "ENSLOCG00000007626", "ENSLOCG00000017524", "ENSLOCG00000007555", "ENSLOCG00000006631", "ENSLOCG00000005433", "ENSLOCG00000009706", "ENSLOCG00000005523", "ENSLOCG00000009723", "ENSLOCG00000011813", "ENSLOCG00000006943", "ENSLOCG00000016901", "ENSLOCG00000001560", "ENSLOCG00000008580", "ENSLOCG00000007431", "ENSLOCG00000006518", "ENSLOCG00000002237", "ENSLOCG00000001740", "ENSLOCG00000011190", "ENSLOCG00000001892", "ENSLOCG00000000959", "ENSLOCG00000012909", "ENSLOCG00000011582", "ENSLOCG00000002861", "ENSLOCG00000017877", "ENSLOCG00000007751", "ENSLOCG00000005316", "ENSLOCG00000004443", "ENSLOCG00000007203", "ENSLOCG00000011628", "ENSLOCG00000004350", "ENSLOCG00000013760", "ENSLOCG00000016314", "ENSLOCG00000004724", "ENSLOCG00000004172", "ENSLOCG00000017827", "ENSLOCG00000004283", "ENSLOCG00000002720", "ENSLOCG00000007982", "ENSLOCG00000013196", "ENSLOCG00000003872", "ENSLOCG00000007594", "ENSLOCG00000002244", "ENSLOCG00000002759", "ENSLOCG00000002237", "ENSLOCG00000002115", "ENSLOCG00000008292", "ENSLOCG00000016816", "ENSLOCG00000008422", "ENSLOCG00000004327", "ENSLOCG00000003996", "ENSLOCG00000001986", "ENSLOCG00000006990", "ENSLOCG00000011926", "ENSLOCG00000016085", "ENSLOCG00000016250", "ENSLOCG00000003812", "ENSLOCG00000012200", "ENSLOCG00000005450", "ENSLOCG00000016815", "ENSLOCG00000016687", "ENSLOCG00000016493", "ENSLOCG00000011705", "ENSLOCG00000005359", "ENSLOCG00000010551", "ENSLOCG00000011036", "ENSLOCG00000003922", "ENSLOCG00000009346", "ENSLOCG00000011086", "ENSLOCG00000000967", "ENSLOCG00000007775", "ENSLOCG00000001098", "ENSLOCG00000004372", "ENSLOCG00000000637", "ENSLOCG00000002009", "ENSLOCG00000004675", "ENSLOCG00000006247", "ENSLOCG00000014212", "ENSLOCG00000014707", "ENSLOCG00000007013", "ENSLOCG00000010937", "ENSLOCG00000010651", "ENSLOCG00000016014", "ENSLOCG00000013515", "ENSLOCG00000008910", "ENSLOCG00000015579", "ENSLOCG00000004390", "ENSLOCG00000016241", "ENSLOCG00000000614", "ENSLOCG00000009232", "ENSLOCG00000013723", "ENSLOCG00000001718", "ENSLOCG00000013622", "ENSLOCG00000008289", "ENSLOCG00000015285", "ENSLOCG00000010405", "ENSLOCG00000014248", "ENSLOCG00000015784", "ENSLOCG00000007113", "ENSLOCG00000004912", "ENSLOCG00000009609", "ENSLOCG00000003930", "ENSLOCG00000002237", "ENSLOCG00000003050", "ENSLOCG00000016332", "ENSLOCG00000001611", "ENSLOCG00000000175", "ENSLOCG00000009736", "ENSLOCG00000005944", "ENSLOCG00000006616", "ENSLOCG00000001099", "ENSLOCG00000004740", "ENSLOCG00000015726", "ENSLOCG00000005202", "ENSLOCG00000009036", "ENSLOCG00000003190", "ENSLOCG00000001222", "ENSLOCG00000016337", "ENSLOCG00000014955", "ENSLOCG00000015856", "ENSLOCG00000010012", "ENSLOCG00000015517", "ENSLOCG00000006006", "ENSLOCG00000007064", "ENSLOCG00000015080", "ENSLOCG00000014435", "ENSLOCG00000003075", "ENSLOCG00000013300", "ENSLOCG00000004894", "ENSLOCG00000010762", "ENSLOCG00000003195", "ENSLOCG00000016126", "ENSLOCG00000010428", "ENSLOCG00000017472", "ENSLOCG00000015217", "ENSLOCG00000003609", "ENSLOCG00000013260", "ENSLOCG00000005194", "ENSLOCG00000016666", "ENSLOCG00000015847", "ENSLOCG00000005673", "ENSLOCG00000000752", "ENSLOCG00000005396", "ENSLOCG00000002745", "ENSLOCG00000011231", "ENSLOCG00000006199", "ENSLOCG00000008983", "ENSLOCG00000008348", "ENSLOCG00000010869", "ENSLOCG00000015814", "ENSLOCG00000009269", "ENSLOCG00000003951", "ENSLOCG00000014787", "ENSLOCG00000002273", "ENSLOCG00000017296", 
"ENSLOCG00000004724", "ENSLOCG00000016921", "ENSLOCG00000013962", "ENSLOCG00000008198", "ENSLOCG00000004397", "ENSLOCG00000011881", "ENSLOCG00000008377", "ENSLOCG00000014409", "ENSLOCG00000003057", "ENSLOCG00000017709", "ENSLOCG00000005236", "ENSLOCG00000004658", "ENSLOCG00000005173", "ENSLOCG00000015461", "ENSLOCG00000005278", "ENSLOCG00000002237", "ENSLOCG00000004099", "ENSLOCG00000005357", "ENSLOCG00000006101", "ENSLOCG00000016329", "ENSLOCG00000006039", "ENSLOCG00000003413", "ENSLOCG00000007072", "ENSLOCG00000005231", "ENSLOCG00000015893", "ENSLOCG00000001110", "ENSLOCG00000006621", "ENSLOCG00000006193", "ENSLOCG00000008586", "ENSLOCG00000014460", "ENSLOCG00000009659", "ENSLOCG00000017760", "ENSLOCG00000012067", "ENSLOCG00000012500", "ENSLOCG00000010618", "ENSLOCG00000016684", "ENSLOCG00000014272", "ENSLOCG00000014687", "ENSLOCG00000010106", "ENSLOCG00000008198", "ENSLOCG00000014970", "ENSLOCG00000016837", "ENSLOCG00000007630", "ENSLOCG00000017030", "ENSLOCG00000000510", "ENSLOCG00000008025", "ENSLOCG00000006502", "ENSLOCG00000015461", "ENSLOCG00000007868", "ENSLOCG00000005522", "ENSLOCG00000007994", "ENSLOCG00000003985", "ENSLOCG00000009942", "ENSLOCG00000010065", "ENSLOCG00000003711", "ENSLOCG00000018091", "ENSLOCG00000007603", "ENSLOCG00000000036", "ENSLOCG00000005443", "ENSLOCG00000010182", "ENSLOCG00000006071", "ENSLOCG00000014691", "ENSLOCG00000000775", "ENSLOCG00000008409", "ENSLOCG00000012029", "ENSLOCG00000009938", "ENSLOCG00000017060", "ENSLOCG00000000956", "ENSLOCG00000003670", "ENSLOCG00000013141", "ENSLOCG00000000279", "ENSLOCG00000016912", "ENSLOCG00000016173", "ENSLOCG00000001520", "ENSLOCG00000002012", "ENSLOCG00000015437", "ENSLOCG00000013919", "ENSLOCG00000004892", "ENSLOCG00000008000", "ENSLOCG00000003943", "ENSLOCG00000008539", "ENSLOCG00000008378", "ENSLOCG00000005262", "ENSLOCG00000003296", "ENSLOCG00000010585", "ENSLOCG00000008054", "ENSLOCG00000017452", "ENSLOCG00000012538", "ENSLOCG00000010967", "ENSLOCG00000008170", "ENSLOCG00000017452", "ENSLOCG00000015037", "ENSLOCG00000004239", "ENSLOCG00000015190", "ENSLOCG00000009085", "ENSLOCG00000015544", "ENSLOCG00000010727", "ENSLOCG00000010592", "ENSLOCG00000008031", "ENSLOCG00000009741", "ENSLOCG00000013118", "ENSLOCG00000011221", "ENSLOCG00000015449", "ENSLOCG00000014920", "ENSLOCG00000012553", "ENSLOCG00000010517", "ENSLOCG00000017452", "ENSLOCG00000011782", "ENSLOCG00000007658", "ENSLOCG00000011221", "ENSLOCG00000003724", "ENSLOCG00000014528", "ENSLOCG00000010080", "ENSLOCG00000003798", "ENSLOCG00000006708", "ENSLOCG00000012627", "ENSLOCG00000003524", "ENSLOCG00000005611", "ENSLOCG00000016645", "ENSLOCG00000014977",
"ENSLOCG00000013555", "ENSLOCG00000000036", "ENSLOCG00000008556", "ENSLOCG00000003342", "ENSLOCG00000012531", "ENSLOCG00000018182", "ENSLOCG00000006692", "ENSLOCG00000016222", "ENSLOCG00000005557", "ENSLOCG00000012010", "ENSLOCG00000009645", "ENSLOCG00000011683", "ENSLOCG00000005968", "ENSLOCG00000012674", "ENSLOCG00000004189", "ENSLOCG00000005500", "ENSLOCG00000007387", "ENSLOCG00000005431", "ENSLOCG00000010130", "ENSLOCG00000011824", "ENSLOCG00000014521", "ENSLOCG00000004636", "ENSLOCG00000010528", "ENSLOCG00000001314")

#### Creation of GO annotation ####

db <- useMart('ENSEMBL_MART_ENSEMBL',dataset='loculatus_gene_ensembl')
go_ids <- getBM(attributes=c('go_id', 'ensembl_gene_id'), filters='ensembl_gene_id', values=bg_genes_gar, mart=db)

gene_2_GO <- unstack(go_ids[,c(1,2)])

# remove any foreground/background candidate genes without GO annotation
foreground_with_GO <- foreground[foreground %in% go_ids[,2]]

background_with_GO <- bg_genes_gar[bg_genes_gar %in% go_ids[,2]]

gene_list <- factor(as.integer(background_with_GO %in% foreground_with_GO))
names(gene_list) <- background_with_GO

#### Create the topGOdata object ####
GOdata <- new('topGOdata', ontology='BP', allGenes = gene_list, annot = annFUN.gene2GO, gene2GO = gene_2_GO)

#### Test for significance ####

# define test using the weight01 algorithm (default) with fisher
weight_fisher_result <- runTest(GOdata, algorithm='weight01', statistic='fisher') 

# generate a table of results: we can use the GenTable function to generate a summary table with the results from tests applied to the topGOdata object.
allGO <- usedGO(GOdata)
all_res <- GenTable(GOdata, weightFisher=weight_fisher_result, orderBy='weightFisher', topNodes=length(allGO))

#### Correcting for multiple testing ####

#performing BH correction on our p values
p.adj <- round(p.adjust(all_res$weightFisher,method="BH"),digits = 4)

# create the file with all the statistics from GO analysis
all_res_final <- cbind(all_res,p.adj)
all_res_final <- all_res_final[order(all_res_final$p.adj),]

#get list of significant GO before multiple testing correction
results.table.p <-all_res_final[which(all_res_final$weightFisher<=0.001),]

#get list of significant GO after multiple testing correction
results.table.bh <- all_res_final[which(all_res_final$p.adj<=0.05),]

#save first top 50 ontolgies sorted by adjusted pvalues
write.table(all_res_final[1:50,],"/workspace/Biodiversity-Bioinformatics/data/summary_topGO_analysis.tsv",sep="\t",quote=FALSE,row.names=FALSE)
